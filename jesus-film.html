<!doctype html>
<html>

<head>
    <title>Jesus Film - Multiple Languages</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Watch the Jesus Film in multiple languages">
    <meta name="keywords" content="jesus, film, movie, languages, christian">
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="https://unpkg.com/@videojs/http-streaming@3.10.0/dist/videojs-http-streaming.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .language-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .language-selector label {
            font-weight: 600;
            color: #333;
        }

        .language-selector select {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            background: white;
            min-width: 200px;
            transition: border-color 0.3s;
        }

        .language-selector select:focus {
            outline: none;
            border-color: #667eea;
        }

        .load-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .load-btn:hover {
            transform: translateY(-2px);
        }

        .video-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .video-wrapper {
            position: relative;
            width: 100%;
            overflow: hidden;
            padding-top: 56.25%;
            border-radius: 10px;
            overflow: hidden;
        }

        #jf-player {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 100%;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .loading::after {
            content: "";
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #c33;
        }

        .info {
            background: #e8f4f8;
            color: #2980b9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #2980b9;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <a href="index.html" class="back-link">‚Üê Back to Main</a>

    <div class="header">
        <h1>The Jesus Film</h1>
        <p>Experience the life of Jesus Christ in over 1,100 languages</p>
    </div>

    <div class="controls">
        <div class="language-selector">
            <label for="language-select">Choose Language:</label>
            <select id="language-select">
                <option value="">Select a language...</option>
                <option value="1">English</option>
                <option value="2">Spanish</option>
                <option value="3">French</option>
                <option value="8">Arabic</option>
                <option value="16">Portuguese</option>
                <option value="21">German</option>
                <option value="22">Italian</option>
                <option value="25">Dutch</option>
                <option value="26">Russian</option>
                <option value="27">Hindi</option>
                <option value="28">Chinese (Mandarin)</option>
                <option value="29">Japanese</option>
                <option value="30">Korean</option>
                <option value="31">Turkish</option>
                <option value="32">Hebrew</option>
                <option value="33">Greek</option>
                <option value="34">Polish</option>
                <option value="35">Romanian</option>
                <option value="36">Czech</option>
                <option value="37">Hungarian</option>
                <option value="38">Swedish</option>
                <option value="39">Norwegian</option>
                <option value="40">Danish</option>
                <option value="41">Finnish</option>
                <option value="42">Bulgarian</option>
                <option value="43">Croatian</option>
                <option value="44">Serbian</option>
                <option value="45">Slovenian</option>
                <option value="46">Slovak</option>
                <option value="47">Lithuanian</option>
                <option value="48">Latvian</option>
                <option value="50">Estonian</option>
                <option value="51">Ukrainian</option>
                <option value="52">Bengali</option>
                <option value="53">Urdu</option>
                <option value="54">Tamil</option>
                <option value="55">Telugu</option>
                <option value="57">Malayalam</option>
                <option value="58">Gujarati</option>
                <option value="59">Marathi</option>
                <option value="60">Punjabi</option>
                <option value="61">Kannada</option>
                <option value="62">Odia</option>
                <option value="63">Assamese</option>
                <option value="64">Nepali</option>
                <option value="65">Sinhalese</option>
                <option value="66">Thai</option>
                <option value="67">Vietnamese</option>
                <option value="68">Indonesian</option>
                <option value="69">Malay</option>
                <option value="70">Tagalog</option>
                <option value="71">Cebuano</option>
                <option value="72">Burmese</option>
                <option value="73">Khmer</option>
                <option value="74">Lao</option>
                <option value="75">Mongolian</option>
                <option value="76">Tibetan</option>
                <option value="77">Persian</option>
                <option value="87">Swahili</option>
                <option value="88">Hausa</option>
                <option value="91">Yoruba</option>
                <option value="92">Igbo</option>
                <option value="94">Amharic</option>
                <option value="95">Oromo</option>
                <option value="96">Tigrinya</option>
                <option value="97">Somali</option>
                <option value="98">Afrikaans</option>
                <option value="99">Zulu</option>
                <option value="100">Xhosa</option>
            </select>
            <button class="load-btn" onclick="loadSelectedLanguage()">Load Video</button>
        </div>
    </div>

    <div class="video-container">
        <div id="jf-player">
            <div class="info">
                <strong>Welcome!</strong> Select a language above and click "Load Video" to watch the Jesus Film in your
                preferred language.
            </div>
        </div>
    </div>

    <script>
        var langIds = [
            { twr: 1, jf: 529 },
            { twr: 2, jf: 21028 },
            { twr: 3, jf: 20615 },
            { twr: 8, jf: 22658 },
            { twr: 16, jf: 3934 },
            { twr: 21, jf: 6464 },
            { twr: 22, jf: 1106 },
            { twr: 25, jf: 1444 },
            { twr: 26, jf: 584 },
            { twr: 27, jf: 5848 },
            { twr: 28, jf: 13169 },
            { twr: 29, jf: '23179' },
            { twr: 30, jf: 7083 },
            { twr: 31, jf: 496 },
            { twr: 32, jf: 16639 },
            { twr: 33, jf: 3887 },
            { twr: 34, jf: 1942 },
            { twr: 35, jf: 139082 },
            { twr: 36, jf: 3804 },
            { twr: 37, jf: 1269 },
            { twr: 38, jf: 483 },
            { twr: 39, jf: 5541 },
            { twr: 40, jf: 1109 },
            { twr: 41, jf: 1964 },
            { twr: 42, jf: 7698 },
            { twr: 43, jf: 5546 },
            { twr: 44, jf: 4432 },
            { twr: 45, jf: 4823 },
            { twr: 46, jf: 6788 },
            { twr: 47, jf: 4451 },
            { twr: 48, jf: 12551 },
            { twr: 50, jf: 4415 },
            { twr: 51, jf: 12876 },
            { twr: 52, jf: 6930 },
            { twr: 53, jf: 4473 },
            { twr: 54, jf: 46771 },
            { twr: 55, jf: 23326 },
            { twr: 57, jf: 7547 },
            { twr: 58, jf: 18259 },
            { twr: 59, jf: 1370 },
            { twr: 60, jf: 2075 },
            { twr: 61, jf: 2149 },
            { twr: 62, jf: 20526 },
            { twr: 63, jf: 1341 },
            { twr: 64, jf: 20581 },
            { twr: 65, jf: 1107 },
            { twr: 66, jf: 5545 },
            { twr: 67, jf: 4466 },
            { twr: 68, jf: 1254 },
            { twr: 69, jf: 6596 },
            { twr: 70, jf: 184528 },
            { twr: 71, jf: 19985 },
            { twr: 72, jf: 5871 },
            { twr: 73, jf: 6318 },
            { twr: 74, jf: 6174 },
            { twr: 75, jf: 1304 },
            { twr: 76, jf: 10393 },
            { twr: 77, jf: 2075 },
            { twr: 87, jf: 8418 },
            { twr: 88, jf: 4791 },
            { twr: 91, jf: 5174 },
            { twr: 92, jf: 2104 },
            { twr: 94, jf: 9131 },
            { twr: 95, jf: 1269 },
            { twr: 96, jf: 20611 },
            { twr: 97, jf: 20601 },
            { twr: 98, jf: 3887 },
            { twr: 99, jf: 9774 },
            { twr: 100, jf: 12784 },
            { twr: 101, jf: 494 },
            { twr: 103, jf: 139114 },
            { twr: 104, jf: 12327 },
            { twr: 105, jf: 389 },
            { twr: 106, jf: 164216 },
            { twr: 107, jf: 1171 },
            { twr: 108, jf: 6199 },
            { twr: 109, jf: 21661 },
            { twr: 110, jf: 13172 },
            { twr: 113, jf: 139082 },
            { twr: 114, jf: 13195 },
            { twr: 122, jf: 24273 },
            { twr: 123, jf: 16107 },
            { twr: 124, jf: 4700 },
            { twr: 125, jf: 20900 },
            { twr: 126, jf: 20679 },
            { twr: 127, jf: 20857 },
            { twr: 128, jf: 7790 },
            { twr: 129, jf: 7773 },
            { twr: 130, jf: 8506 },
            { twr: 131, jf: 564 },
            { twr: 132, jf: 4344 },
            { twr: 134, jf: 13408 },
            { twr: 135, jf: 12723 },
            { twr: 136, jf: 1278 },
            { twr: 138, jf: 21027 },
            { twr: 140, jf: 4454 },
            { twr: 141, jf: 24309 },
            { twr: 142, jf: 53400 },
            { twr: 143, jf: 20896 },
            { twr: 144, jf: 1308 },
            { twr: 147, jf: 16618 },
            { twr: 148, jf: 20547 },
            { twr: 149, jf: 20857 },
            { twr: 150, jf: 3803 },
            { twr: 151, jf: 7897 },
            { twr: 152, jf: 184515 },
            { twr: 153, jf: 12399 },
            { twr: 154, jf: 7309 },
            { twr: 155, jf: 7285 },
            { twr: 156, jf: 7334 },
            { twr: 157, jf: 4820 },
            { twr: 158, jf: 1927 },
            { twr: 159, jf: 20533 },
            { twr: 160, jf: 24014 },
            { twr: 161, jf: 1197 },
            { twr: 163, jf: 20947 },
            { twr: 164, jf: 53370 },
            { twr: 165, jf: 2000 },
            { twr: 166, jf: 20796 },
            { twr: 168, jf: 53417 },
            { twr: 169, jf: 22685 },
            { twr: 170, jf: 5766 },
            { twr: 171, jf: 6463 },
            { twr: 172, jf: 5667 },
            { twr: 173, jf: 20777 },
            { twr: 174, jf: 19877 },
            { twr: 175, jf: 646 },
            { twr: 176, jf: 7761 },
            { twr: 178, jf: 5459 },
            { twr: 179, jf: 5048 },
            { twr: 181, jf: 4576 },
            { twr: 186, jf: 371 }
        ];

        var currentPlayer = null;

        var getVideo = function getJesusFilmVideoLink(id) {
            $('#jf-player').html('<div class="loading">Loading video...</div>');

            $.get('https://api-v1.arclight.org/v2/media-components/1_jf-0-0/languages/' + id + '?apiKey=52aa01f9ac52e6.29922389&platform=ios')
                .done(function (data) {
                    console.log('API Response:', data);
                    var video = null;

                    // Try download URL first (better CORS support for direct video files)
                    if (data.downloadUrls && data.downloadUrls.high && data.downloadUrls.high.url) {
                        video = data.downloadUrls.high.url;
                    }
                    // Fallback to streaming URL (may have CORS issues)
                    else if (data.streamingUrls && data.streamingUrls.m3u8 && data.streamingUrls.m3u8[0] && data.streamingUrls.m3u8[0].url) {
                        video = data.streamingUrls.m3u8[0].url;
                    }

                    if (video) {
                        // Create video wrapper with proper aspect ratio
                        $('#jf-player').html(`
                        <div class="video-wrapper">
                            <video id="jesus-film-video" class="video-js vjs-default-skin vjs-big-play-centered" 
                                   controls preload="auto" width="100%" height="100%" 
                                   style="position: absolute; top: 0; left: 0; bottom: 0; right: 0;"
                                   data-setup='{"fluid": true}'>
                                <p class="vjs-no-js">
                                    To view this video please enable JavaScript, and consider upgrading to a
                                    web browser that supports HTML5 video.
                                </p>
                            </video>
                        </div>
                        <div style="text-align: center; margin-top: 10px; color: #666;"><small>Checking video URL...</small></div>
                    `);

                        // Function to check and resolve URL redirects
                        function checkVideoUrl(url, type) {
                            console.log('Checking video URL:', url);

                            // Skip URL check for known problematic domains (Brightcove, etc.)
                            if (url.includes('boltdns.net') || url.includes('brightcove') || type === 'application/x-mpegURL') {
                                console.log('Skipping URL check for streaming service, proceeding directly...');
                                return Promise.resolve({
                                    url: url,
                                    type: type,
                                    success: true,
                                    skipped: true
                                });
                            }

                            return fetch(url, {
                                method: 'HEAD',
                                mode: 'cors'
                            })
                                .then(response => {
                                    console.log('URL check response:', {
                                        status: response.status,
                                        finalUrl: response.url,
                                        redirected: response.redirected,
                                        headers: Object.fromEntries(response.headers.entries())
                                    });

                                    if (response.ok) {
                                        // Use the final resolved URL
                                        return {
                                            url: response.url,
                                            type: type,
                                            success: true
                                        };
                                    } else {
                                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                    }
                                })
                                .catch(error => {
                                    console.error('URL check failed (likely CORS):', error);

                                    // For CORS errors, try to proceed anyway
                                    if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                                        console.log('CORS error detected, proceeding with original URL...');
                                        return {
                                            url: url,
                                            type: type,
                                            success: true,
                                            corsIssue: true
                                        };
                                    }

                                    return {
                                        url: url,
                                        type: type,
                                        success: false,
                                        error: error.message
                                    };
                                });
                        }

                        // Initialize Video.js player
                        if (currentPlayer) {
                            currentPlayer.dispose();
                        }

                        currentPlayer = videojs('jesus-film-video', {
                            fluid: true,
                            responsive: true,
                            crossOrigin: 'anonymous',
                            html5: {
                                hls: {
                                    withCredentials: false
                                }
                            }
                        });

                        // Determine video type and check URL
                        var videoType = video.includes('.m3u8') ? 'application/x-mpegURL' : 'video/mp4';

                        checkVideoUrl(video, videoType)
                            .then(result => {
                                // Remove the checking message
                                $('#jf-player div:last').remove();

                                if (result.success) {
                                    console.log('Using video URL:', result.url);

                                    currentPlayer.ready(function () {
                                        this.src({
                                            src: result.url,
                                            type: result.type
                                        });
                                    });
                                } else {
                                    console.log('Primary URL failed, trying fallback...');
                                    tryFallbackUrl();
                                }
                            })
                            .catch(error => {
                                console.error('URL check error:', error);
                                tryFallbackUrl();
                            });

                        function tryFallbackUrl() {
                            // Try streaming URL as fallback if we started with download URL
                            if (data.streamingUrls && data.streamingUrls.m3u8 && data.streamingUrls.m3u8[0] && data.streamingUrls.m3u8[0].url) {
                                console.log('Trying streaming URL fallback:', data.streamingUrls.m3u8[0].url);

                                checkVideoUrl(data.streamingUrls.m3u8[0].url, 'application/x-mpegURL')
                                    .then(result => {
                                        $('#jf-player div:last').remove();

                                        if (result.success) {
                                            currentPlayer.ready(function () {
                                                this.src({
                                                    src: result.url,
                                                    type: result.type
                                                });
                                            });
                                        } else {
                                            tryFinalFallback();
                                        }
                                    });
                            } else {
                                tryFinalFallback();
                            }
                        }

                        function tryFinalFallback() {
                            // Last resort: try other download qualities
                            if (data.downloadUrls) {
                                var fallbackUrls = [];
                                if (data.downloadUrls.medium && data.downloadUrls.medium.url) {
                                    fallbackUrls.push({ url: data.downloadUrls.medium.url, quality: 'medium' });
                                }
                                if (data.downloadUrls.low && data.downloadUrls.low.url) {
                                    fallbackUrls.push({ url: data.downloadUrls.low.url, quality: 'low' });
                                }

                                if (fallbackUrls.length > 0) {
                                    console.log('Trying additional download qualities:', fallbackUrls);

                                    var fallbackUrl = fallbackUrls[0].url;
                                    currentPlayer.ready(function () {
                                        this.src({
                                            src: fallbackUrl,
                                            type: 'video/mp4'
                                        });
                                    });
                                    return;
                                }
                            }

                            $('#jf-player').html('<div class="error">Unable to load video from any source. This may be due to CORS restrictions or network issues.<br><small>Try refreshing the page or selecting a different language.</small></div>');
                        }

                        // Add error handling for VideoJS
                        currentPlayer.on('error', function (e) {
                            console.error('VideoJS Error:', e);
                            var error = currentPlayer.error();
                            console.error('Error details:', error);

                            $('#jf-player').html('<div class="error">Video playback failed. The video format may not be supported by your browser.</div>');
                        });
                    } else {
                        $('#jf-player').html('<div class="error">Sorry, video not available for this language. Please try another language.</div>');
                    }
                })
                .fail(function (xhr, status, error) {
                    console.error('API Error:', error);
                    $('#jf-player').html('<div class="error">Failed to load video. Please check your internet connection and try again.</div>');
                });
        };

        var getLanguage = function filterLanguageBySiteId(id) {
            const ids = langIds.filter(function (lang) {
                return lang.twr === parseInt(id);
            });
            if (ids[0]) {
                getVideo(ids[0].jf);
            } else {
                // Default to English if language not found
                console.warn('Language ID not found, defaulting to English');
                getVideo(529);
            }
        };

        function loadSelectedLanguage() {
            const select = document.getElementById('language-select');
            const languageId = select.value;

            if (!languageId) {
                alert('Please select a language first.');
                return;
            }

            getLanguage(languageId);
        }

        // Auto-load from URL parameter if present
        $(document).ready(function () {
            const urlParams = new URLSearchParams(window.location.search);
            const langParam = urlParams.get('lang');

            if (langParam) {
                $('#language-select').val(langParam);
                getLanguage(langParam);
            }
        });

        // Handle select change
        $('#language-select').change(function () {
            const selectedLang = $(this).val();
            if (selectedLang) {
                // Update URL without page reload
                const newUrl = window.location.protocol + "//" + window.location.host +
                    window.location.pathname + "?lang=" + selectedLang;
                window.history.pushState({ path: newUrl }, '', newUrl);
            }
        });
    </script>
</body>

</html>